<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discussion - Black Star Academy</title>
    <link rel="stylesheet" href="style.css">
    <script defer src="script.js"></script>
</head>
<body>
  
    <nav class="navbar">
        <div class="navbar-logo">
            <img src="logo.jpg" alt="Logo Black Star Academy" class="logo-img">
            <a href="index.html" style="text-decoration:none;color:inherit;"><span>Black_Star_Academy</span></a>
        </div>
        <div class="navbar-burger" id="navbar-burger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul class="navbar-links" id="navbar-links">
            <li><a href="index.html">Accueil</a></li>
            <li><a href="index.html#apropos">√Ä propos</a></li>
           
            <li class="dropdown">
                <a href="equipe.html">Equipes</a>
                
            </li>
            <li class="dropdown">
                <a href="activite.html">Services</a>

            </li>
            <li class="dropdown">
                <a href="formation.html">Formation </a>
                
            </li>
          

            <li><a href="discusion.html">Discussion</a></li>
             <li><a href="discusion.html"></a></li>
             <li><a href="discusion.html"></a></li>

            
        </ul>
            
        </ul>
    </nav>
    <div style="height:18px;"></div>
    <button id="theme-toggle" class="theme-toggle" style="margin-left:18px;">üåô</button>
    <section class="forum-section">
        <h2>Forum de discussion</h2>
        <div id="auth-section">
            <button id="connect-btn" style="display:block;width:100%;padding:10px 0;background:#0077ff;color:#fff;border:none;border-radius:6px;font-size:1.1rem;margin-bottom:18px;cursor:pointer;">
                Se connecter
            </button>
            <form id="login-form" class="forum-form" style="display:block;">
                <input type="email" id="login-email" placeholder="Adresse email" required />
                <input type="password" id="login-password" placeholder="Mot de passe" required />
                <button type="submit">Se connecter</button>
                <p>Pas de compte ? <a href="#" id="show-register">S'inscrire</a></p>
            </form>
            <form id="register-form" class="forum-form" style="display:none;">
                <input type="text" id="register-name" placeholder="Nom complet" required />
                <input type="email" id="register-email" placeholder="Adresse email" required />
                <input type="password" id="register-password" placeholder="Mot de passe" required />
                <button type="submit">S'inscrire</button>
                <p>D√©j√† inscrit ? <a href="#" id="show-login">Se connecter</a></p>
            </form>
        </div>
        <form class="forum-form" id="forum-form" style="display:none;">
            <textarea id="message" placeholder="Votre message..." required></textarea>
            <input type="file" id="media-file" accept="image/*,video/*" />
            <button type="submit">Envoyer</button>
        </form>
        <div class="forum-messages" id="forum-messages"></div>
        <div id="profile-modal" class="profile-modal" style="display:none;"></div>
    </section>
  <!-- ...footer identique √† index.html... -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-col">
                <h4>Navigation</h4>
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="index.html#apropos">√Ä propos</a></li>
                    <li><a href="index.html#services">Services</a></li>
                    <li><a href="discusion.html">Discussion</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Suivez-nous</h4>
                <ul>
                    <li><a href="https://www.facebook.com/profile.php?id=100084826891532">Facebook</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="https://www.youtube.com/@blackstaracademy903/shorts">YouTube</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Contact</h4>
                <ul>
                    <li><a href="//mail.google.com/mail/?view=cm&fs=1&to=twambapo@gmail.com">twambapo@gmail.com</a></li>
                    <li><a href="https://wa.me/+237697404179?text= besoinn de savoir plus svp">whatsapp</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <span>Design by <strong>emmanuel.dev</strong> &copy; 2025</span>
        </div>
    </footer>
    <script>
const authSection = document.getElementById('auth-section');
const loginForm = document.getElementById('login-form');
const registerForm = document.getElementById('register-form');
const showRegister = document.getElementById('show-register');
const showLogin = document.getElementById('show-login');
const forumForm = document.getElementById('forum-form');
const messagesDiv = document.getElementById('forum-messages');
const profileModal = document.getElementById('profile-modal');
let users = JSON.parse(localStorage.getItem('forumUsers') || '[]');
let messages = JSON.parse(localStorage.getItem('forumMessages') || '[]');
let currentUser = JSON.parse(localStorage.getItem('forumCurrentUser') || 'null');

// CHAMP FICHIER DANS LE FORMULAIRE PRINCIPAL
forumForm.innerHTML = `
  <textarea id="message" placeholder="Votre message..." required></textarea>
  <input type="file" id="media-file" accept="image/*,video/*" />
  <button type="submit">Envoyer</button>
`;

function showProfile(email) {
    const user = users.find(u => u.email === email);
    if (!user) return;
    profileModal.innerHTML = `<div class='profile-content'><h3>Profil</h3><p><strong>Nom :</strong> ${user.name}</p><p><strong>Email :</strong> ${user.email}</p><button id='close-profile'>Fermer</button></div>`;
    profileModal.style.display = 'block';
    document.getElementById('close-profile').onclick = () => profileModal.style.display = 'none';
}

function renderMessages() {
    messagesDiv.innerHTML = '';
    messages.forEach((m, idx) => {
        let mediaHtml = '';
        if (m.media) {
            if (m.media.startsWith('data:video')) {
                mediaHtml = `<video controls width="300" src="${m.media}"></video>`;
            } else if (m.media.startsWith('data:image')) {
                mediaHtml = `<img src="${m.media}" width="300" />`;
            }
        }

        let repliesHtml = '';
        if (m.replies && m.replies.length) {
            repliesHtml = `<div class='forum-replies'>` + m.replies.map((r) => {
                let replyMedia = '';
                if (r.media) {
                    if (r.media.startsWith('data:video')) {
                        replyMedia = `<video controls width="250" src="${r.media}"></video>`;
                    } else if (r.media.startsWith('data:image')) {
                        replyMedia = `<img src="${r.media}" width="250" />`;
                    }
                }
                return `
                  <div class='forum-reply'>
                    <span class='user-name' data-email='${r.email}' style='cursor:pointer;color:#ff9800;'>${r.name}</span>
                    <span class='forum-date'>${r.date}</span>
                    <p>${r.text}</p>
                    ${replyMedia}
                  </div>`;
            }).join('') + `</div>`;
        }

        let replyBtn = currentUser ? `<button class='reply-btn' data-idx='${idx}'>R√©pondre</button>` : '';
        let likeBtn = `<button class='like-btn' data-idx='${idx}'>üëç <span>${m.likes?.length || 0}</span></button>`;

        messagesDiv.innerHTML += `
          <div class='forum-msg' data-idx='${idx}'>
            <span class='user-name' data-email='${m.email}' style='cursor:pointer;color:#ff9800;'>${m.name}</span>
            <span class='forum-date'>${m.date}</span>
            <p>${m.text}</p>
            ${mediaHtml}
            <div class='forum-actions'>${likeBtn} ${replyBtn}</div>
            <div class='forum-reply-form' style='display:none;'></div>
            ${repliesHtml}
          </div>`;
    });

    addForumListeners();
}

function addForumListeners() {
    document.querySelectorAll('.user-name').forEach(span => {
        span.onclick = function () {
            showProfile(this.dataset.email);
        };
    });

    document.querySelectorAll('.like-btn').forEach(btn => {
        btn.onclick = function () {
            if (!currentUser) return;
            const idx = this.dataset.idx;
            messages[idx].likes = messages[idx].likes || [];
            if (!messages[idx].likes.includes(currentUser.email)) {
                messages[idx].likes.push(currentUser.email);
                localStorage.setItem('forumMessages', JSON.stringify(messages));
                renderMessages();
            }
        };
    });

    document.querySelectorAll('.reply-btn').forEach(btn => {
        btn.onclick = function () {
            const idx = this.dataset.idx;
            const msgDiv = this.closest('.forum-msg');
            const replyForm = msgDiv.querySelector('.forum-reply-form');
            if (replyForm.innerHTML) return;
            replyForm.innerHTML = `
              <form class='reply-form'>
                <textarea name='text' placeholder='Votre r√©ponse...' required></textarea>
                <input type='file' name='media' accept='image/*,video/*' />
                <button type='submit'>Envoyer</button>
              </form>
            `;
            replyForm.style.display = 'block';
            replyForm.querySelector('form').onsubmit = function (e) {
                e.preventDefault();
                const text = this.text.value.trim();
                const file = this.media.files[0];
                if (currentUser && text) {
                    const date = new Date().toLocaleString();
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = () => {
                            messages[idx].replies = messages[idx].replies || [];
                            messages[idx].replies.push({ name: currentUser.name, email: currentUser.email, text, date, media: reader.result });
                            localStorage.setItem('forumMessages', JSON.stringify(messages));
                            renderMessages();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        messages[idx].replies = messages[idx].replies || [];
                        messages[idx].replies.push({ name: currentUser.name, email: currentUser.email, text, date });
                        localStorage.setItem('forumMessages', JSON.stringify(messages));
                        renderMessages();
                    }
                }
            };
        };
    });
}

// Authentification
showRegister.onclick = function(e) {
    e.preventDefault();
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
};
showLogin.onclick = function(e) {
    e.preventDefault();
    registerForm.style.display = 'none';
    loginForm.style.display = 'block';
};

registerForm.onsubmit = function (e) {
    e.preventDefault();
    const name = document.getElementById('register-name').value.trim();
    const email = document.getElementById('register-email').value.trim().toLowerCase();
    const password = document.getElementById('register-password').value;
    if (users.find(u => u.email === email)) return alert('Cet email est d√©j√† utilis√©.');
    users.push({ name, email, password });
    localStorage.setItem('forumUsers', JSON.stringify(users));
    alert('Inscription r√©ussie, connectez-vous !');
    registerForm.style.display = 'none';
    loginForm.style.display = 'flex';
};

loginForm.onsubmit = function (e) {
    e.preventDefault();
    const email = document.getElementById('login-email').value.trim().toLowerCase();
    const password = document.getElementById('login-password').value;
    const user = users.find(u => u.email === email && u.password === password);
    if (!user) return alert('Identifiants incorrects.');
    localStorage.setItem('forumCurrentUser', JSON.stringify(user));
    location.reload();
};

function showForumForm() {
    if (currentUser) {
        forumForm.style.display = 'flex';
        authSection.style.display = 'none';
    } else {
        forumForm.style.display = 'none';
        authSection.style.display = 'block';
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
    }
}

forumForm.onsubmit = function (e) {
    e.preventDefault();
    const text = document.getElementById('message').value.trim();
    const file = document.getElementById('media-file').files[0];
    if (currentUser && text) {
        const date = new Date().toLocaleString();
        if (file) {
            const reader = new FileReader();
            reader.onload = () => {
                messages.push({ name: currentUser.name, email: currentUser.email, text, date, media: reader.result, replies: [], likes: [] });
                localStorage.setItem('forumMessages', JSON.stringify(messages));
                renderMessages();
                forumForm.reset();
            };
            reader.readAsDataURL(file);
        } else {
            messages.push({ name: currentUser.name, email: currentUser.email, text, date, replies: [], likes: [] });
            localStorage.setItem('forumMessages', JSON.stringify(messages));
            renderMessages();
            forumForm.reset();
        }
    }
};

document.getElementById('connect-btn').onclick = function() {
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('register-form').style.display = 'none';
};

showForumForm();
renderMessages();
</script>

</body>
</html>
</html>
